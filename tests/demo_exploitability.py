#!/usr/bin/env python3
"""
Demo script showing how to use VulnReach with exploitability analysis

This script demonstrates how to:
1. Run vulnerability scanning
2. Analyze exploitability using SearchSploit
3. Generate comprehensive security reports with exploit information
"""

import json
import subprocess
import sys
from pathlib import Path

def demo_exploitability_analysis():
    """Demonstrate exploitability analysis functionality"""
    
    print("üõ°Ô∏è  VulnReach Exploitability Analysis Demo")
    print("=" * 60)
    
    print("""
This demo shows how to use VulnReach with the new exploitability analysis feature.

The exploitability analysis integrates SearchSploit (Exploit Database) to:
‚Ä¢ Check for publicly available exploits for each CVE
‚Ä¢ Analyze component names and versions for exploit matches
‚Ä¢ Generate risk scores based on exploit availability
‚Ä¢ Provide structured JSON output for further processing

Usage Examples:
""")
    
    print("1Ô∏è‚É£  Basic vulnerability scan with exploitability analysis:")
    print("   vulnreach /path/to/project --run-exploitability")
    print()
    
    print("2Ô∏è‚É£  Comprehensive analysis with all features:")
    print("   vulnreach /path/to/project --run-reachability --run-exploitability")
    print()
    
    print("3Ô∏è‚É£  Using existing SBOM with exploitability analysis:")
    print("   vulnreach --sbom project_sbom.json --run-exploitability")
    print()
    
    print("4Ô∏è‚É£  Direct directory scan with exploitability analysis:")
    print("   vulnreach /path/to/project --direct-scan --run-exploitability")
    print()
    
    print("üìã Prerequisites for full exploitability analysis:")
    print("   ‚Ä¢ SearchSploit: apt update && apt install exploitdb")
    print("   ‚Ä¢ Exploit Database: automatically installed with SearchSploit")
    print()
    
    print("üìä Output Files Generated:")
    print("   ‚Ä¢ security_report.json - Standard vulnerability report")
    print("   ‚Ä¢ exploitability_report.json - Detailed exploit analysis")
    print("   ‚Ä¢ consolidated.json - Package upgrade recommendations")
    print()
    
    print("üîç Exploitability Report Structure:")
    sample_structure = {
        "metadata": {
            "analysis_timestamp": "2025-08-29T...",
            "tool_version": "vulnreach-exploitability-1.0",
            "searchsploit_available": True,
            "total_vulnerabilities_analyzed": 10
        },
        "summary": {
            "total_vulnerabilities": 10,
            "vulnerabilities_with_exploits": 5,
            "exploit_availability_rate": 50.0,
            "critical_exploitable": 2,
            "high_exploitable": 3,
            "exploit_risk_breakdown": {
                "CRITICAL": 2,
                "HIGH": 3,
                "MEDIUM": 2,
                "LOW": 1,
                "NONE": 2
            }
        },
        "vulnerability_analyses": [
            {
                "cve_id": "CVE-2021-44228",
                "component_name": "log4j-core",
                "component_version": "2.14.1", 
                "severity": "CRITICAL",
                "cvss_score": 10.0,
                "exploit_count": 5,
                "has_public_exploits": True,
                "exploit_risk_level": "CRITICAL",
                "exploits_found": [
                    {
                        "title": "Apache Log4j2 2.14.1 - Remote Code Execution (RCE)",
                        "path": "/usr/share/exploitdb/exploits/java/remote/50592.py",
                        "date": "2021-12-17",
                        "author": "kozmer",
                        "type": "remote",
                        "platform": "java",
                        "exploit_db_id": "50592"
                    }
                ]
            }
        ],
        "high_priority_vulnerabilities": "# Only CRITICAL/HIGH risk exploits"
    }
    
    print(json.dumps(sample_structure, indent=2))
    
    print("\nüéØ Risk Level Classification:")
    print("   üî¥ CRITICAL: High CVSS + multiple exploits available")
    print("   üü† HIGH: High severity + exploits available")  
    print("   üü° MEDIUM: Medium severity + limited exploits")
    print("   üü¢ LOW: Low severity + few/old exploits")
    print("   ‚ö™ NONE: No public exploits found")
    
    print("\nüöÄ Try it yourself:")
    print(f"   cd {Path(__file__).parent}")
    print("   vulnreach test_packages/python_vuln_app --run-exploitability")
    
    print("\nüìö For more information, see:")
    print("   ‚Ä¢ README.md for installation instructions")
    print("   ‚Ä¢ exploitability_analyzer.py for implementation details")


if __name__ == "__main__":
    demo_exploitability_analysis()